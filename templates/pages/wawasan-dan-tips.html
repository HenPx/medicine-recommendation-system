{% extends 'layouts/mainMenu.html' %}

{% block content %}
<h1 style="text-align:center;">Chat with Our HealthBot</h1>
<div id="chatbox">
    <div id="chat"></div>
    <input type="text" id="user-input" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    function sendMessage() {
        const userInput = document.getElementById("user-input").value.trim();
        const chat = document.getElementById("chat");

        if (userInput === "") return;

        // Display user message
        const userMessage = document.createElement("div");
        userMessage.className = "user-message";
        userMessage.textContent = userInput;
        chat.appendChild(userMessage);

        // Clear input field immediately
        document.getElementById("user-input").value = "";

        // Auto-scroll to the bottom
        chat.scrollTop = chat.scrollHeight;

        // Send user message to the chatbot API
        fetch("/chatbot-konsultasi", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: userInput })
        })
        .then(response => response.json())
        .then(data => {
            const botMessage = document.createElement("div");
            botMessage.className = "bot-message";
            botMessage.textContent = data.response || "I'm sorry, I didn't understand that.";
            chat.appendChild(botMessage);

            // Auto-scroll to the bottom after adding bot response
            chat.scrollTop = chat.scrollHeight;
        })
        .catch(error => {
            console.error("Error:", error);
            const errorMessage = document.createElement("div");
            errorMessage.className = "bot-message";
            errorMessage.textContent = "Oops! Something went wrong. Please try again.";
            chat.appendChild(errorMessage);

            // Auto-scroll to the bottom after adding error message
            chat.scrollTop = chat.scrollHeight;
        });
    }
</script>

{% endblock %}
