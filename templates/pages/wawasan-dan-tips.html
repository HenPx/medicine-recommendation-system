<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GObat</title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/output-style.css')}}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>

</head>
<body class="bg-[#F8F8FF]">
    <div class="flex flex-col font-['Poppins'] bg-[#E5E7EB]">
        <div class="flex flex-col md:flex-row p-6 bg-gray-200">
            <!-- Sidebar -->
            <div class="bg-[#673AB7] w-full md:w-20 flex md:flex-col rounded-lg items-center md:pt-8 py-2 md:py-0">
                <div class="mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-10 h-10">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </div>
            </div>
        
            <!-- Chat Container with Fixed Background and Min Height -->
            <div class="flex flex-col w-full bg-[#E5E7EB]">
                <p class="text-2xl   text-center bg-[#E5E7EB] text-[#673AB7]">Chat with Our <strong>HealthBot</strong></p>
                <div id="loading-indicator" class="text-center text-gray-500   hidden">Processing...</div>

                <div id="chatbox" class="flex-1 overflow-y-auto bg-[#E5E7EB] px-6 py-4 pb-0 bg-purple-50  ">
                    <div
                        id="chat"
                        class="space-y-4  bg-cover bg-no-repeat   rounded-lg  h-96 min-h-[500px] overflow-y-auto"
                        style="background-image: url('/path/to/your/chat-wallpaper.png'); background-size: cover;"
                    >
                        <!-- Chat messages will appear here -->

                    </div>
                </div>
        
                <!-- Input Section -->
                <div class="flex items-center p-4 pt-0 bg-[#E5E7EB]  border-purple-300  rounded-b-lg">
                    <input
                        type="text"
                        id="user-input"
                        placeholder="Type your message..."
                        onkeydown="if(event.key === 'Enter') sendMessage()"
                        class="flex-1 p-3 rounded-l-lg border border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    />
                    <button
                        onclick="sendMessage()"
                        class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-r-lg flex items-center justify-center"
                    >
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h4l3-8m4 0l3 8h4M5 12h14M4 16h16M4 20h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="mt-auto">
            {% include 'partials/footer.html' %}
        </div>
    </div>
    
    
</body>
<script>
    function sendMessage() {
        const userInput = document.getElementById("user-input").value.trim();
        const chat = document.getElementById("chat");
        const loadingIndicator = document.getElementById("loading-indicator");

        if (userInput === "") return;

        // Display user message
        const userMessageDiv = document.createElement("div");
        userMessageDiv.className = "user-message bg-green-100 text-green-800 p-3 rounded-xl shadow-md ml-auto w-fit max-w-[80%]";
        userMessageDiv.textContent = userInput;
        chat.appendChild(userMessageDiv);

        const marginMessage = document.createElement("div");
        marginMessage.className = " mb-3 ";
        marginMessage.textContent = "";
        chat.appendChild(marginMessage);


        // Clear input field and show loading indicator
        document.getElementById("user-input").value = "";
        loadingIndicator.classList.remove("hidden");

        // Auto-scroll to bottom
        chat.scrollTop = chat.scrollHeight;

        // Send user message to the chatbot API
        fetch("/chatbot-konsultasi", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: userInput })
        })
        .then(response => response.json())
        .then(data => {
            const botMessageDiv = document.createElement("div");
            botMessageDiv.className = "bot-message bg-red-100 text-red-800 p-3 mb-3 rounded-xl shadow-md mr-auto w-fit max-w-[80%]";
            botMessageDiv.textContent = data.response || "I'm sorry, I didn't understand that.";
            chat.appendChild(botMessageDiv);
            
            const marginMessage = document.createElement("div");
            marginMessage.className = " mb-3 ";
            marginMessage.textContent = "";
            chat.appendChild(marginMessage);

            // Hide loading indicator after bot response
            loadingIndicator.classList.add("hidden");

            // Auto-scroll to bottom after adding bot response
            chat.scrollTop = chat.scrollHeight;
        })
        .catch(error => {
            console.error("Error:", error);
            const errorMessageDiv = document.createElement("div");
            errorMessageDiv.className = "bot-message bg-red-100 text-red-800 p-3 rounded-xl shadow-md mr-auto w-fit max-w-[80%]";
            errorMessageDiv.textContent = "Oops! Something went wrong. Please try again.";
            chat.appendChild(errorMessageDiv);

            // Hide loading indicator after error message
            loadingIndicator.classList.add("hidden");

            // Auto-scroll to bottom after adding error message
            chat.scrollTop = chat.scrollHeight;
        });
    }
</script>
</html>
